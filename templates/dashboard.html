{% extends 'base.html' %}

{% block head %}
<title>User Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock head %}

{% block body %}
<div class="container-fluid welcome" style="padding: 20px;">
    <div class="container">
        <br><br>

        <div class="row align-items-center mb-4 p-4" style="background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div class="col-md-2 text-center">
                <img src="{{ url_for('static', filename='uploads/' + (pdata.profile_pic if pdata and pdata.profile_pic else 'default.png')) }}"
                     alt="Profile"
                     style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #007bff;">
            </div>
            <div class="col-md-7">
                <h1 class="display-4">{{ name }}</h1>
                <p class="lead">
                    <span class="badge badge-info">{{ session['role']|upper }} ACCOUNT</span> |
                    Events Booked: <strong>{{ cn.count }}</strong>
                </p>
                {% if pdata and pdata.age %}
                <p>Age: {{ pdata.age }} | Contact: {{ pdata.contact1 }}</p>
                {% else %}
                <p class="text-danger">Profile Incomplete. <a href="/personal">Update Now</a></p>
                {% endif %}
            </div>
            <div class="col-md-3 text-right">
                <a class="btn btn-danger" href='/logout'>Logout</a>
                <a class="btn btn-primary" href='/personal'>Edit Profile</a>
            </div>
        </div>

        <hr>

        <h2 class="mb-3">My Booked Events</h2>
        <div class="table-responsive" style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <table class="table table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Event ID</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Venue</th>
                        <th>Cost</th>
                        <th>Status</th>
                        <th>Visibility</th>
                        <th>Action</th> </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr>
                        <td>#{{ event.eid }}</td>
                        <td>{{ event.etype }}</td>
                        <td>{{ event.edate }}</td>
                        <td>{{ event.evenue }}</td>
                        <td>PKR {{ event.ecost }}</td>
                        <td>
                            {% if event.status == 'completed' %}
                            <span class="badge badge-success">Completed</span>
                            {% elif event.status == 'canceled' %}
                            <span class="badge badge-danger">Canceled</span>
                            {% else %}
                            <span class="badge badge-warning">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if event.visibility == 'public' %}
                            <span class="badge badge-info">Public</span>
                            {% else %}
                            <span class="badge badge-secondary">Private</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="/ticket/{{ event.eid }}" target="_blank" class="btn btn-sm btn-outline-dark">
                                ðŸ“„ Ticket
                            </a>
                        </td>
                    </tr>
                    {% endfor %}

                    {% if not events %}
                    <tr>
                        <td colspan="8" class="text-center">No events booked yet. <a href="/home">Book one now!</a></td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock body %}